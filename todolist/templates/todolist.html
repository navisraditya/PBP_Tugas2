{% extends 'base.html' %}

{% block content %}
<div class="background">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
 </div>


 <div class="header">
    <div class="header-user">Who's logged in: {{ user }}</div>
    
    <div class="header-button">
        <button><a href="{% url 'todolist:logout' %}">Logout</a></button>  
    </div>
</div>

<div class="body">
    <div class="todolist-wrapper">

        <h1>Tugas 4 Assignment PBP/PBD</h1>
        <h2>TO DO LIST</h2>
    
        <div class="todolist-text">
            <p>
                <h3>Nama: {{user}}</h3>
                Halo, jadi ini usaha {{ user }} buat ngerjain Tugas 4 PBP. Ya walaupun bingungin tapi oke lah :D <br>
                Sempet bingung kenapa tabel yang di bawah gk bisa update tapi udah fixed (harusnya (semoga))
            </p>
        </div>

        <form id="form" onsubmit="return false;">
            {% csrf_token %}
            <label>Title</label>
            <input type="text" name="title"></input>
            <label>Description</label>
            <input type="text" name="description"></input>
            <button id="button" type="submit"  value="Submit"></button>
          </form>
                

        <div class="todolist-card" style="width: 18rem;" id="card">
            <div class="todolist-card-body">

            </div>
        </div>

        <!-- <button><a href="{% url 'todolist:add_todolist' %}">Add Task</a></button>  -->
    </div> 
</div>



<script>
    async function getTodolist(){
        return fetch("{% url 'todolist:show_json' %}").then((res) => res.json)
    }

    async function refreshTodolist(){
        document.getElementById("card").innerHTML=""
        const todolist = await getTodolist()
        let htmlString = ``
        todolist.forEach((items) => {
            htmlString += `<h5 class="todolist-card-title">{${todo.title}}</h5>
              <h6 class="todolist-card-date">{${todo.date}}</h6>
              <p class="todolist-card-desc">{${todo.description}}</p>`
        })

        document.getElementById("card").innerHTML=htmlString
    }

    function addTodolist(){
        fetch("{% url 'todolist:add_todolist_task' %}", {
            method: "POST",
            body: new FormData(document.querySelector('#form'))
        }).then(refreshTodolist)
        return false
    }

    document.getElementById("button").onclick = addTodolist
    refreshTodolist()

</script>
{% endblock content %}